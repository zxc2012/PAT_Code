# CS61C Lecture6 --Virtual Memory
## Basic

Virtual Memory Goals
- Allow multiple processes to simultaneously occupy memory and provide **protection**: Don’t let programs read/write each other’s memory
- Give each program the illusion that it has its
own **private address space**

![20220603203635](https://raw.githubusercontent.com/zxc2012/image/main/20220603203635.png)

Processes use **virtual addresses**
- Divided into pages indexed by virtual page number(VPN)

Memory uses **physical addresses**
- Divided into pages indexed by phisical page number(PPN)

## Virtual Memory and Page Tables
### Paged Memory

Base & Bound Machine

![20221126210452](https://raw.githubusercontent.com/zxc2012/image/main/20221126210452.png)

Problems
- May need more space than segment allows
- As RAM is fragmented, there isn’t a contiguous chunk available

Paged Memory

Instead of having segments of various sizes, divide physical memory and virtual memory into equal units called *pages*
- Pages are the same size in both virtual and physical memory, and RAM is an integer multiple of pages
- Each program has access to one or more pages(do not have to be contiguous)

![20220603214957](https://raw.githubusercontent.com/zxc2012/image/main/20220603214957.png)

### Address Translation

Virtual addresses can be broken into page number + offset(much likeT/I/O)

- sizeof(Address) = log_2(Virtual Memory Size)
- sizeof(offset) = log_2(page size)
- sizeof(VPN) = log_2(# of virtual pages) = log_2(Virtual Memory Size/page size)

![20220603214329](https://raw.githubusercontent.com/zxc2012/image/main/20220603214329.png)

- sizeof(Address) = log_2(Physical Memory Size)
- sizeof(offset) = log_2(page size)
- sizeof(PPN) = log_2(# of Physical pages)

![20220603214355](https://raw.githubusercontent.com/zxc2012/image/main/20220603214355.png)

![20221126221332](https://raw.githubusercontent.com/zxc2012/image/main/20221126221332.png)

Page Table Entry(mapping physical/virtual pages)

- Dirty: Page has been modified recently
- Valid = Valid page table entry
    - 1: virtual page is in physical memory
    - 0: OS needs to fetch page from disk(Page Fault)
- Access Rights checked on every access to seeif allowed (else protection fault)
    - Read, Write, Executable
- PPN

![20220603215849](https://raw.githubusercontent.com/zxc2012/image/main/20220603215849.png)