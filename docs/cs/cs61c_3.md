# CS61C Lecture3 --RISC V Single-Cycle Control and Pipelining

## Basics

![20220310173933](https://raw.githubusercontent.com/zxc2012/image/main/20220326211448.png)

![20220310173933](https://raw.githubusercontent.com/zxc2012/image/main/20220331161846.png)


## Instruction Table 

|Inst[31:0] |BrEq| BrLT| PCSel| ImmSel |BrUn| ASel| BSel| ALUSel| MemRW|RegWEn|WBSel|
|- |-| -| -|- |-| -| -| -| -| -| -|
|add| * |* |+4| *| * |Reg| Reg| Add| Read| 1 (Y)| ALU|
|sub| *| *| +4| *| * |Reg| Reg| Sub| Read| 1 |ALU|
|(R-ROp)|*| *| +4| *| *| Reg| Reg |(Op) |Read| 1 |ALU|
|addi| *| *| +4| I| * |Reg| Imm| Add| Read |1 |ALU|
|lw| *| *| +4| I |* |Reg| Imm| Add| Read| 1| Mem|
|sw| *| *| +4 |S |* |Reg |Imm |Add |Write| 0 (N) |*|
|beq| 0| *| +4| B| *| PC| Imm| Add |Read| 0 |*|
|beq |1| * |ALU| B| *| PC |Imm |Add |Read| 0 |*|
|bne| 0 |*| ALU |B |* |PC| Imm |Add |Read| 0 |*|
|bne| 1| *| +4| B |* |PC |Imm| Add| Read| 0 |*|
|blt |* |1 |ALU |B |0| PC| Imm| Add |Read |0| *|
|bltu| * |1 |ALU| B |1 |PC| Imm |Add| Read| 0| *|
|jalr |* |*| ALU| I |*| Reg| Imm| Add |Read| 1| PC+4|
|jal| *| * |ALU |J |* |PC |Imm |Add| Read| 1| PC+4|
|auipc| * |* |+4| U| * |PC |Imm| Add| Read| 1 |ALU|

## Single Cycle

![20220310173933](https://raw.githubusercontent.com/zxc2012/image/main/20220326210350.png)

Control Logic

- ImmSel:

    ![20220331174415](https://raw.githubusercontent.com/zxc2012/image/main/20220331174415.png)

    ![20220310173933](https://raw.githubusercontent.com/zxc2012/image/main/20220326220059.png)

- BrUn,BrEq,BrLT:

    ![20220310173933](https://raw.githubusercontent.com/zxc2012/image/main/20220326220429.png)

- ALUSel: 

    ![20220310173933](https://raw.githubusercontent.com/zxc2012/image/main/20220326211210.png)

## Pipelined

![20220331211348](https://raw.githubusercontent.com/zxc2012/image/main/20220331211348.png)

### Hazard

#### Structural Hazard

- Problem
    
    Two or more instructions in the pipeline compete for access to a single **physical resource**

- Solution
    - (1)Instructions take turns using resource, some
instructions have to stall (wait)
    - (2)Add more hardware to machine

![20220310173933](https://raw.githubusercontent.com/zxc2012/image/main/20220401220248.png)